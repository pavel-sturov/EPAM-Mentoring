!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/dist",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);const i="user_name",n={GREETING:"Welcome to WS chat!",START_CHAT:"Please enter your name to start",NAME_PLACEHOLDER:"Name...",OFF:"Offline",ONN:"Online",NO_MESSAGES:"Your first messages...",ENTER_MESSAGE:"Message",DISCONNECTED:"Disconnected"};function o(t,e){t.forEach(t=>e.appendChild(t))}function r(t,e){const s=document.createElement(t);return e&&s.classList.add(e),s}function a(t){this.wrapper=r("div","login-form"),this.h2=r("h2"),this.input=r("input"),this.submitNameBtn=r("button"),this.h2.innerText=n.START_CHAT,this.input.setAttribute("placeholder",n.NAME_PLACEHOLDER),this.submitNameBtn.addEventListener("click",t)}function h(t,e){this.closeWS=t,this.openWS=e,this.wrapper=r("div","status-wrapper"),this.name=r("div","name"),this.status=r("div","status"),this.status.innerText=n.ONN,this.connectBtn=r("button","connect-btn"),this.logoutBtn=r("button","logout-btn"),this.disconnectBtn=r("button","disconnect-btn"),this.logoutBtn.addEventListener("click",this.logOut.bind(this)),this.connectBtn.addEventListener("click",this.connect.bind(this)),this.disconnectBtn.addEventListener("click",this.disconnect.bind(this))}function c(t,e){this.sendMessageToWS=t,this.notify=e,this.messages=[],this.wrapper=r("div","message-history"),this.sendItemsWrapper=r("div","send-items"),this.status=r("div","no-messages"),this.messageInput=r("textarea","message"),this.send=r("button","send"),this.bottomBtn=r("button","bottom-btn"),this.messageCounter=r("div","msg-counter"),this.status.innerText=n.NO_MESSAGES,this.messageInput.setAttribute("placeholder",n.ENTER_MESSAGE),this.send.addEventListener("click",this.sendMessage.bind(this)),this.bottomBtn.addEventListener("click",this.toScrollDown.bind(this))}function u(){!function(){const t=r("h1");t.innerText=n.GREETING,o([t],document.querySelector("body"))}(),this.userName=localStorage.getItem(i),this.loginForm=new a(this.logIn.bind(this)),this.statusForm=new h(this.closeWS.bind(this),this.openWS.bind(this)),this.messageArea=new c(this.sendMessage.bind(this),this.notify.bind(this)),this.userName?(this.renderChat(),this.openWS()):this.loginForm.addToDOM(),setInterval(()=>{this.messageArea.displayScrollDownBtn()},200)}a.prototype.addToDOM=function(){o([this.wrapper],document.querySelector("body")),o([this.h2,this.input,this.submitNameBtn],this.wrapper),this.wrapper.scrollTop=this.wrapper.scrollHeight},a.prototype.hideLoginForm=function(){this.wrapper.style.display="none"},a.prototype.saveName=function(){const t=this.input.value;return!(t.length<3)&&(e=t,localStorage.setItem(i,e),t);var e},h.prototype.addToDOM=function(t){this.name.innerText=t,o([this.wrapper],document.querySelector("body")),o([this.name,this.status,this.connectBtn,this.logoutBtn,this.disconnectBtn],this.wrapper)},h.prototype.disconnect=function(){this.closeWS(),this.status.classList.toggle("online",!1),this.status.classList.add("offline"),this.status.innerText=n.OFF,this.disconnectBtn.style.visibility="hidden",this.connectBtn.style.visibility="visible"},h.prototype.logOut=function(){localStorage.clear(),this.closeWS(),document.location.reload()},h.prototype.connect=function(){this.openWS(),this.status.innerText=n.ONN,this.status.classList.remove("offline"),this.status.classList.add("online"),this.connectBtn.style.visibility="hidden",this.disconnectBtn.style.visibility="visible"},c.prototype.addToDOM=function(t){this.userName=t,o([this.wrapper,this.sendItemsWrapper],document.querySelector("body")),o([this.status],this.wrapper),o([this.messageInput,this.send,this.bottomBtn,this.messageCounter],this.sendItemsWrapper)},c.prototype.displayScrollDownBtn=function(){this.wrapper.scrollTop+850<this.wrapper.scrollHeight?(this.bottomBtn.style.visibility="visible",this.bottomBtn.style.opacity="1"):(this.bottomBtn.style.opacity="0",this.bottomBtn.style.visibility="hidden")},c.prototype.toScrollDown=function(){this.wrapper.scrollTop=this.wrapper.scrollHeight},c.prototype.sendMessage=function(){this.sendMessageToWS(this.messageInput.value),this.messageInput.value=""},c.prototype.printMessage=function(t){(t=t.sort((t,e)=>t.time-e.time)).forEach(t=>{const{from:e,message:s,time:i}=t,n=r("div",this.userName===e?"my-message":"incoming-message"),a=r("div","text-message"),h=r("div","time"),c=r("div","author-name");c.innerText=e,h.innerText=function(t){const e=new Date(t);let s=e.getHours(),i=e.getMinutes();return i<10&&(i="0"+i),s<10&&(s="0"+s),`${s} : ${i}`}(i),a.innerText=s,o([n],this.wrapper),o([c,a,h],n),this.messages.push(t),document.hidden&&this.notify(t)}),this.wrapper.scrollTop=this.wrapper.scrollHeight},c.prototype.onClose=function(){this.send.style.visibility="hidden",this.messageInput.style.visibility="hidden"},c.prototype.onOpen=function(){this.send.style.visibility="visible",this.messageInput.style.visibility="visible"},u.prototype.closeWS=function(){this.ws.close(),this.messageArea.onClose()},u.prototype.openWS=function(){this.ws=new WebSocket("ws://st-chat.shas.tel"),this.messageArea.onOpen(),this.ws.onmessage=t=>{this.messageArea.printMessage(JSON.parse(t.data))}},u.prototype.renderChat=function(){this.statusForm.addToDOM(this.userName),this.messageArea.addToDOM(this.userName)},u.prototype.sendMessage=function(t){this.ws.send(JSON.stringify({from:this.userName,message:t}))},u.prototype.logIn=function(){this.userName=this.loginForm.saveName(),this.userName&&(this.openWS(),this.loginForm.hideLoginForm(),this.renderChat())},u.prototype.notify=function(t){window.Notification&&"denied"!==Notification.permission&&t&&Notification.requestPermission(e=>{"granted"===e&&new Notification(t.from,{body:t.message})})},document.addEventListener("DOMContentLoaded",()=>new u)}]);