!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/dist",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);const i="user_name",n="ws://st-chat.shas.tel",o={GREETING:"Welcome to WS chat!",START_CHAT:"Please enter your name to start",NAME_PLACEHOLDER:"Name...",OFF:"Offline",ONN:"Online",NO_MESSAGES:"Your first messages...",ENTER_MESSAGE:"Message",DISCONNECTED:"Disconnected"};function r(t,e){t.forEach(t=>e.appendChild(t))}function a(t,e){const s=document.createElement(t);return e&&s.classList.add(e),s}class h{constructor(t){this.logIn=t,this.wrapper=a("div","login-form"),this.h2=a("h2"),this.input=a("input"),this.submitNameBtn=a("button"),this.h2.innerText=o.START_CHAT,this.input.setAttribute("placeholder",o.NAME_PLACEHOLDER),this.submitNameBtn.addEventListener("click",t)}addToDOM(){r([this.wrapper],document.querySelector("body")),r([this.h2,this.input,this.submitNameBtn],this.wrapper),this.wrapper.scrollTop=this.wrapper.scrollHeight}hideLoginForm(){this.wrapper.style.display="none",this.submitNameBtn.removeEventListener("click",this.logIn)}saveName(){const t=this.input.value;return!(t.length<3)&&(e=t,localStorage.setItem(i,e),t);var e}}class l{constructor(t,e){this.closeWS=t,this.openWS=e,this.wrapper=a("div","status-wrapper"),this.name=a("div","name"),this.status=a("div","status"),this.status.innerText=o.ONN,this.connectBtn=a("button","connect-btn"),this.logoutBtn=a("button","logout-btn"),this.disconnectBtn=a("button","disconnect-btn"),this.logoutBtn.addEventListener("click",this.logOut.bind(this)),this.connectBtn.addEventListener("click",this.connect.bind(this)),this.disconnectBtn.addEventListener("click",this.disconnect.bind(this))}addToDOM(t){this.name.innerText=t,r([this.wrapper],document.querySelector("body")),r([this.name,this.status,this.connectBtn,this.logoutBtn,this.disconnectBtn],this.wrapper)}disconnect(){this.closeWS(),this.status.classList.toggle("online",!1),this.status.classList.add("offline"),this.status.innerText=o.OFF,this.disconnectBtn.style.visibility="hidden",this.connectBtn.style.visibility="visible"}logOut(){localStorage.clear(),this.closeWS(),document.location.reload()}connect(){this.openWS(),this.status.innerText=o.ONN,this.status.classList.remove("offline"),this.status.classList.add("online"),this.connectBtn.style.visibility="hidden",this.disconnectBtn.style.visibility="visible"}}class c{constructor(t,e){this.sendMessageToWS=t,this.notify=e,this.messages=[],this.wrapper=a("div","message-history"),this.sendItemsWrapper=a("div","send-items"),this.status=a("div","no-messages"),this.messageInput=a("textarea","message"),this.send=a("button","send"),this.bottomBtn=a("button","bottom-btn"),this.messageCounter=a("div","msg-counter"),this.status.innerText=o.NO_MESSAGES,this.messageInput.setAttribute("placeholder",o.ENTER_MESSAGE),this.send.addEventListener("click",this.sendMessage.bind(this)),this.bottomBtn.addEventListener("click",this.toScrollDown.bind(this))}addToDOM(t){this.userName=t,r([this.wrapper,this.sendItemsWrapper],document.querySelector("body")),r([this.status],this.wrapper),r([this.messageInput,this.send,this.bottomBtn,this.messageCounter],this.sendItemsWrapper)}displayScrollDownBtn(){this.wrapper.scrollTop+850<this.wrapper.scrollHeight?(this.bottomBtn.style.visibility="visible",this.bottomBtn.style.opacity="1"):(this.bottomBtn.style.opacity="0",this.bottomBtn.style.visibility="hidden")}toScrollDown(){this.wrapper.scrollTop=this.wrapper.scrollHeight}sendMessage(){this.sendMessageToWS(this.messageInput.value),this.messageInput.value=""}printMessage(t){(t=t.sort((t,e)=>t.time-e.time)).forEach(t=>{const{from:e,message:s,time:i}=t,n=a("div",this.userName===e?"my-message":"incoming-message"),o=a("div","text-message"),h=a("div","time"),l=a("div","author-name");l.innerText=e,h.innerText=function(t){const e=new Date(t);let s=e.getHours(),i=e.getMinutes();return i<10&&(i="0"+i),s<10&&(s="0"+s),`${s} : ${i}`}(i),o.innerText=s,r([n],this.wrapper),r([l,o,h],n),this.messages.push(t),document.hidden&&this.notify(t)}),this.wrapper.scrollTop=this.wrapper.scrollHeight}onClose(){this.send.style.visibility="hidden",this.messageInput.style.visibility="hidden"}onOpen(){this.send.style.visibility="visible",this.messageInput.style.visibility="visible"}}class d{constructor(){!function(){const t=a("h1");t.innerText=o.GREETING,r([t],document.querySelector("body"))}(),this.userName=localStorage.getItem(i),this.loginForm=new h(this.logIn.bind(this)),this.statusForm=new l(this.closeWS.bind(this),this.openWS.bind(this)),this.messageArea=new c(this.sendMessage.bind(this),this.notify.bind(this)),this.userName?(this.renderChat(),this.openWS()):this.loginForm.addToDOM(),setInterval(()=>{this.messageArea.displayScrollDownBtn()},200)}closeWS(){this.ws.close(),this.messageArea.onClose()}openWS(){this.ws=new WebSocket(n),this.messageArea.onOpen(),this.ws.onmessage=t=>{this.messageArea.printMessage(JSON.parse(t.data))}}renderChat(){this.statusForm.addToDOM(this.userName),this.messageArea.addToDOM(this.userName)}sendMessage(t){this.ws.send(JSON.stringify({from:this.userName,message:t}))}logIn(){this.userName=this.loginForm.saveName(),this.userName&&(this.openWS(),this.loginForm.hideLoginForm(),this.renderChat())}notify(t){window.Notification&&"denied"!==Notification.permission&&t&&Notification.requestPermission(e=>{"granted"===e&&new Notification(t.from,{body:t.message})})}}document.addEventListener("DOMContentLoaded",()=>new d)}]);